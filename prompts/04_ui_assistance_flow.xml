<?xml version="1.0" encoding="UTF-8"?>
<prompt>
  <metadata>
    <title>UI Implementation - Assistance Flow</title>
    <phase>4</phase>
    <difficulty>high</difficulty>
    <estimated_time>60-90 minutes</estimated_time>
    <version>1.0</version>
    <last_updated>2025-11-19</last_updated>
    
    <prerequisites>
      <prerequisite>03_ui_landing_auth.xml completed</prerequisite>
      <prerequisite>Google Maps API Key (or Mapbox)</prerequisite>
    </prerequisites>
  </metadata>

  <thinking_configuration>
    <claude_extended_thinking>
      <enabled>true</enabled>
      <reasoning>
        This is the core "Uber-like" functionality. It requires complex state management (location, service type, provider status) 
        and real-time updates (simulated for MVP). The UI must be intuitive under stress (emergency context).
      </reasoning>
      <budget_tokens>12000</budget_tokens>
      <expected_thinking_depth>
        Design the state machine for an assistance request:
        Idle -> Location Selected -> Service Selected -> Searching Provider -> Provider Found -> En Route -> Arrived -> Completed.
        Plan the UI components for each state.
      </expected_thinking_depth>
    </claude_extended_thinking>
  </thinking_configuration>

  <context>
    <project_info>
      <name>Hugo Automotriz</name>
      <framework>Next.js 15</framework>
    </project_info>

    <objective>
      <primary>
        Implement the real-time assistance request flow. 
        Users should be able to share their location, select a service (Grúa, Batería, etc.), and track the arrival of a provider.
        **Context**: Bolivia (Santa Cruz/La Paz/Cochabamba as default map focus if needed).
      </primary>
      <success_criteria>
        <criterion>✅ Map component renders and captures user location</criterion>
        <criterion>✅ Service selection UI is clear and accessible (Spanish labels)</criterion>
        <criterion>✅ "Requesting" state provides visual feedback (loaders, status text)</criterion>
        <criterion>✅ End-to-end flow works (Request -> Simulated Match -> Completion)</criterion>
      </success_criteria>
    </objective>
  </context>

  <instructions>
    <step number="1">
      <title>Implement Map Component</title>
      <thinking_guidance>
        Choose a map library (e.g., `react-google-maps` or `leaflet`).
        Create a reusable `<MapPicker />` component that allows users to pin their location.
        Must handle geolocation permissions gracefully.
        Default center: Santa Cruz de la Sierra or La Paz, Bolivia.
      </thinking_guidance>
      <action>
        Create `src/components/assistance/MapPicker.tsx`.
        It should accept `onLocationSelect` callback.
      </action>
    </step>

    <step number="2">
      <title>Create Service Selection UI</title>
      <thinking_guidance>
        Design a grid of large, touch-friendly buttons for service types.
        Each button should have an icon and label.
        Services: Grúa (Tow), Batería (Battery), Llanta (Tire), Gasolina (Fuel), Mecánico (Mechanic).
        Labels must be in Spanish.
      </thinking_guidance>
      <action>
        Create `src/components/assistance/ServiceSelector.tsx`.
        Use Lucide icons for visuals.
      </action>
    </step>

    <step number="3">
      <title>Build the Request Flow Container</title>
      <thinking_guidance>
        Create a main page `src/app/dashboard/request/page.tsx`.
        Use a multi-step form or a single dynamic view managed by state.
        State: `step` (location | service | confirm | tracking).
      </thinking_guidance>
      <commands>
        <![CDATA[
npx shadcn@latest add badge separator progress drawer
        ]]>
      </commands>
      <action>
        Implement the page logic.
        1. Step 1: Map (Confirm Location).
        2. Step 2: Service Selector.
        3. Step 3: Summary &amp; Price Estimate (Mocked logic).
        4. Step 4: "Searching..." animation.
      </action>
    </step>

    <step number="4">
      <title>Implement Tracking Interface</title>
      <thinking_guidance>
        Once a provider is "found" (simulated), show the driver details (Name, Vehicle, Rating) and ETA.
        Show a progress bar or map route.
      </thinking_guidance>
      <action>
        Create `src/components/assistance/TrackingView.tsx`.
        Include "Call Driver" and "Cancel" buttons.
      </action>
    </step>
  </instructions>

  <validation>
    <execution_checklist>
      <item>✅ Map correctly centers on user location</item>
      <item>✅ Selecting a service updates the state</item>
      <item>✅ "Request" button triggers the API (or mock action)</item>
      <item>✅ Tracking view displays correct mock data</item>
    </execution_checklist>
  </validation>

  <output_format>
    <structure>
      <section name="flow_diagram">State machine description</section>
    </structure>
    <format>Markdown</format>
  </output_format>
</prompt>
